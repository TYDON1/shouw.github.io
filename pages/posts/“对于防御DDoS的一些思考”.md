---
title: “对于防御DDoS的一些思考”
date: 2025-10-13 20:17:46
author: shouw
email: shouw707@gmail.com
readmore: true
tags:
  - 技术
  - 网络攻防
  - 技巧
---

## DDoS攻击防御策略：利用Cloudflare Zero Trust Tunnel

随着网络技术的日益发达，DDoS（Distributed Denial of Service，分布式拒绝服务）攻击这种非常古老但却几乎没有办法有效阻止的网络攻击手段也是愈发强大。最近，我们看到了Cloudflare（以下简称CF）防御了峰值为 **22 Tbps** 的DDoS攻击，这是一个惊人的数字。要知道，在2020年，中国电信骨干网总出口带宽也才4 Tbps左右，这足以显示出当前DDoS攻击规模的恐怖。

面对如此巨大的威胁，传统的防御手段往往显得力不从心。那么，该如何构筑有效的防御体系呢？

我认为可以采用 **Cloudflare Zero Trust Tunnel（以下简称Tunnel）** 技术作为核心防御手段，实现流量的集中管理和清洗。

### 1. 利用Tunnel技术实现L4层防御的核心策略

Tunnel技术允许您在无需开放任何公共入站端口的情况下，将应用服务安全地连接到Cloudflare网络。其核心防御逻辑和优势如下：

1. **让所有流量都走CF（流量强制清洗）：** 通过在源站服务器上运行`cloudflared`守护进程，建立一个加密、**出站**的通道到Cloudflare的网络边缘。所有针对该服务的流量，都必须先到达Cloudflare边缘网络进行清洗。
2. **隐藏源站IP地址：** 由于Tunnel的连接是出站的，您的服务器的公网IP地址理论上可以不对外暴露。攻击者将无法知道您的真实服务器地址，从而彻底杜绝了**绕过CDN/代理的直接L4层攻击**。
3. **消除防火墙入站规则的依赖：** **（更正与补充）** 对于通过Tunnel暴露的应用，服务器的 **80/443等服务端口甚至不需要对外开放任何入站规则**。Tunnel连接是源站主动发起并保持的，外部流量经CF边缘网络通过此Tunnel进入服务器的内部（如`127.0.0.1:80`）。

**优点：** 这种架构能够有效防止所有的外来的 **L4层（网络层/传输层，如SYN Flood, UDP Flood, ICMP Flood）** 流量攻击。无论攻击流量规模多大，都会在Cloudflare的全球网络边缘被吸收和清洗，避免对源站基础设施造成压力。

### 2. L7层（应用层）的防御策略

然而，仅依赖Tunnel只能解决L4层的攻击问题。对于 **L7层（应用层，如HTTP Flood, Slowloris）** 的DDoS攻击，由于它们模仿了正常的HTTP请求，因此需要更精细的规则来识别和防御。

**防御措施：**

* **利用Cloudflare托管WAF规则集：** 启用CF提供的托管WAF规则集，这些规则集会持续更新，以防御最新的常见应用层漏洞和攻击。这是防御L7攻击的第一道防线。
* **配置速率限制（Rate Limiting）：** 这是防御HTTP Flood等L7攻击的最有效手段之一。根据服务的正常流量阈值，配置每IP在单位时间内的请求上限，超出限制的IP将自动被阻止或挑战。
* **自行编写自定义WAF规则（Custom Rules）：** 针对特定的、具有明显特征的攻击（如异常的User-Agent、Headers、特定的URL路径等），可以在Cloudflare WAF中编写自定义规则进行阻止、质询或日志记录。
* **启用安全功能：** 启用并配置如“浏览器完整性检查”、“Hotlink保护”以及“爬虫管理”等功能，以减少非人类或恶意自动程序的流量。
* **使用DDoS Attack Protection管理：** 利用Cloudflare的DDoS防护设置，确保安全级别配置正确，在遭受攻击时可以手动或自动提高安全级别至“I'm Under Attack!”模式。
