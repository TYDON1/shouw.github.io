import{_ as p}from"./ValaxyMain.vue_vue_type_style_index_0_lang.BUealcc4.js";import{e as c,u as f,a as g}from"./chunks/vue-router.B1Bs5WmQ.js";import{ab as b,aq as a,ak as t,af as l,ah as n,B as x,aa as S,D as P}from"./framework.BL_Vg4VX.js";import"./app.Cnj2OdXP.js";import"./chunks/dayjs.BdcnXKr1.js";import"./chunks/vue-i18n.DUR6B0Mh.js";import"./chunks/pinia.QNVjLoFo.js";/* empty css                    */import"./chunks/@vueuse/motion.UmYfS3E7.js";import"./chunks/nprogress.Bru8d7fl.js";import"./YunComment.vue_vue_type_style_index_0_lang.C8GEnHY8.js";import"./index.C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang.faGiqylc.js";import"./post.COeAA1oJ.js";const k=c('/posts/"保持进程后台运行的实现方式"',async r=>JSON.parse('{"title":"保持进程后台运行的实现方式","description":"","frontmatter":{"title":"保持进程后台运行的实现方式","date":"2025-12-30 10:54:55","author":"shouw","email":"KijinSeija@shouw.blog","readmore":true,"tags":["技术","网络","Linux","技巧"]},"headers":[],"relativePath":"pages/posts/\\"保持进程后台运行的实现方式\\".md","lastUpdated":1769855156000}'),{lazy:(r,o)=>r.name===o.name}),V={__name:'"保持进程后台运行的实现方式"',setup(r,{expose:o}){const{data:s}=k(),m=g(),h=f(),u=Object.assign(h.meta.frontmatter||{},s.value?.frontmatter||{});return m.currentRoute.value.data=s.value,P("valaxy:frontmatter",u),globalThis.$frontmatter=u,o({frontmatter:{title:"保持进程后台运行的实现方式",date:"2025-12-30 10:54:55",author:"shouw",email:"KijinSeija@shouw.blog",readmore:!0,tags:["技术","网络","Linux","技巧"]}}),(e,i)=>{const d=p;return S(),b(d,{frontmatter:x(u)},{"main-content-md":a(()=>[...i[0]||(i[0]=[l("h1",{id:"保持进程后台运行的实现方式",tabindex:"-1"},[n("保持进程后台运行的实现方式 "),l("a",{class:"header-anchor",href:"#保持进程后台运行的实现方式","aria-label":'Permalink to "保持进程后台运行的实现方式"'},"​")],-1),l("p",null,[n("在 Linux 服务器上进行开发或运维时，我们经常面临一个问题：当你通过 SSH 远程连接服务器并运行一个耗时较长的任务（比如编译大型项目、训练深度学习模型、传输大文件）时，如果网络波动导致 SSH 断开，或者你不得不关闭电脑，终端会话结束，随之而来的就是正在运行的进程被系统发送的 "),l("code",null,"SIGHUP"),n(" 信号无情杀掉。")],-1),l("p",null,"为了解决这个问题，我们需要让进程在“后台”持续运行，即使当前终端关闭也不受影响。本文将介绍几种主流的实现方式，并分析它们的优缺点。",-1),l("h2",{id:"_1-基础方案-号与-disown",tabindex:"-1"},[n("1. 基础方案：& 号与 disown "),l("a",{class:"header-anchor",href:"#_1-基础方案-号与-disown","aria-label":'Permalink to "1. 基础方案：& 号与 disown"'},"​")],-1),l("p",null,"最简单的后台运行方式是利用 Shell 的内置功能。",-1),l("h3",{id:"使用方法",tabindex:"-1"},[n("使用方法 "),l("a",{class:"header-anchor",href:"#使用方法","aria-label":'Permalink to "使用方法"'},"​")],-1),l("p",null,[n("在命令最后加上 "),l("code",null,"&"),n(" 符号，可以将命令放入后台运行：")],-1),l("p",null,"但是，这样做仅仅是让命令在当前 Shell 的后台运行。如果 Shell 关闭，进程依然可能被杀掉。为了避免这种情况，需要配合 disown 命令：",-1),l("p",null,"如果你已经运行了一个前台程序，可以按 Ctrl+Z 暂停它，然后：",-1),l("h3",{id:"利弊分析",tabindex:"-1"},[n("利弊分析 "),l("a",{class:"header-anchor",href:"#利弊分析","aria-label":'Permalink to "利弊分析"'},"​")],-1),l("ul",null,[l("li",null,[l("p",null,[n("​"),l("strong",null,"优点"),n("​：无需安装任何额外软件，所有 Linux 发行版通用，操作极快。")])]),l("li",null,[l("p",null,[n("​"),l("strong",null,"缺点"),n("​：")]),l("ul",null,[l("li",null,[n("​"),l("strong",null,"无法重新连接"),n("​：一旦关闭终端，你再也看不到程序的标准输出（stdout），无法与程序交互。")]),l("li",null,[n("​"),l("strong",null,"管理困难"),n("​：只能通过 ps 或 kill 来管理进程，容易遗忘。")])])])],-1),l("hr",null,null,-1),l("h2",{id:"_2-经典方案-nohup",tabindex:"-1"},[n("2. 经典方案：nohup "),l("a",{class:"header-anchor",href:"#_2-经典方案-nohup","aria-label":'Permalink to "2. 经典方案：nohup"'},"​")],-1),l("p",null,"nohup (No Hang Up) 是最经典的解决方案，它的唯一用途就是让命令忽略挂起信号（SIGHUP）。",-1),l("h3",{id:"使用方法-1",tabindex:"-1"},[n("使用方法 "),l("a",{class:"header-anchor",href:"#使用方法-1","aria-label":'Permalink to "使用方法"'},"​")],-1),l("ul",null,[l("li",null,"nohup：忽略挂起信号。"),l("li",null,[l("blockquote",null,[l("p",null,"：重定向标准输出。")])]),l("li",null,"2>&1：将标准错误重定向到标准输出。"),l("li",null,"&：放入后台运行。")],-1),l("p",null,"如果不指定重定向文件，nohup 会默认将输出写入当前目录下的 nohup.out。",-1),l("h3",{id:"利弊分析-1",tabindex:"-1"},[n("利弊分析 "),l("a",{class:"header-anchor",href:"#利弊分析-1","aria-label":'Permalink to "利弊分析"'},"​")],-1),l("ul",null,[l("li",null,[l("p",null,[n("​"),l("strong",null,"优点"),n("​：系统自带，简单稳定，自动保留日志文件。")])]),l("li",null,[l("p",null,[n("​"),l("strong",null,"缺点"),n("​：")]),l("ul",null,[l("li",null,[n("​"),l("strong",null,"无法交互"),n("​：和 & 一样，程序一旦运行就没法再“回到”那个界面输入指令了（比如程序中途需要输入 'yes' 确认）。")]),l("li",null,[n("​"),l("strong",null,"日志膨胀"),n("​：如果程序输出量极大，nohup.out 会迅速占用磁盘空间。")])])])],-1),l("hr",null,null,-1),l("h2",{id:"_3-进阶方案-tmux-screen-推荐",tabindex:"-1"},[n("3. 进阶方案：Tmux / Screen (推荐) "),l("a",{class:"header-anchor",href:"#_3-进阶方案-tmux-screen-推荐","aria-label":'Permalink to "3. 进阶方案：Tmux / Screen (推荐)"'},"​")],-1),l("p",null,[n("这是目前开发者最爱使用的方案。Tmux 和 Screen 属于​"),l("strong",null,[n("终端复用器 (Terminal Multiplexer)"),l("strong",null,"​。它们允许你在一个 SSH 会话中创建多个“虚拟终端”，并且这些虚拟终端可以与当前 SSH 会话​"),n("分离 (Detach)"),l("strong",null,"​，在后台保持运行，稍后还可以"),n("重新连接 (Attach)")]),n(" 回去。")],-1),l("p",null,"这里主要推荐 Tmux。",-1),l("h3",{id:"使用方法-2",tabindex:"-1"},[n("使用方法 "),l("a",{class:"header-anchor",href:"#使用方法-2","aria-label":'Permalink to "使用方法"'},"​")],-1),l("ul",null,[l("li",null,[l("strong",null,"安装 Tmux"),n(" (如果未安装)：")]),l("li",null,[n("​"),l("strong",null,"创建新会话"),n("​：")]),l("li",null,[n("​"),l("strong",null,"在 Tmux 中运行任务"),n("​： 正常执行你的命令，比如 python train.py。")]),l("li",null,[n("​"),l("strong",null,"分离会话"),n(" (Detach)​： 按下快捷键 Ctrl + B，松开后按 d。 此时你会回到原本的 Shell，但任务依然在后台那个“平行宇宙”里跑着。")]),l("li",null,[l("strong",null,"重新连接"),n(" (Attach)​： 回家连上 VPN 后，想看看跑得怎么样了：")])],-1),l("h3",{id:"利弊分析-2",tabindex:"-1"},[n("利弊分析 "),l("a",{class:"header-anchor",href:"#利弊分析-2","aria-label":'Permalink to "利弊分析"'},"​")],-1),l("ul",null,[l("li",null,[l("p",null,[n("​"),l("strong",null,"优点"),n("​：")]),l("ul",null,[l("li",null,[n("​"),l("strong",null,"上下文保留"),n("​：不仅进程在跑，连终端里的历史输出、环境变量、当前目录都完好无损。")]),l("li",null,[n("​"),l("strong",null,"可交互"),n("​：随时回去查看进度，如果程序报错或者需要输入，可以直接操作。")]),l("li",null,[n("​"),l("strong",null,"多窗口"),n("​：一个 Tmux 会话里可以开多个窗口，分屏操作，极其高效。")])])]),l("li",null,[l("p",null,[n("​"),l("strong",null,"缺点"),n("​：")]),l("ul",null,[l("li",null,"需要额外安装软件。"),l("li",null,"有快捷键的学习成本（虽然只需要记住几个核心的就行）。")])])],-1),l("hr",null,null,-1),l("h2",{id:"_4-生产级方案-systemd",tabindex:"-1"},[n("4. 生产级方案：Systemd "),l("a",{class:"header-anchor",href:"#_4-生产级方案-systemd","aria-label":'Permalink to "4. 生产级方案：Systemd"'},"​")],-1),l("p",null,"如果你是在部署一个长期运行的服务（比如 Web 服务器、数据库、监控脚本），而不是临时的跑个脚本，那么 Systemd 才是正道。它是 Linux 的系统和服务管理器。",-1),l("h3",{id:"使用方法-3",tabindex:"-1"},[n("使用方法 "),l("a",{class:"header-anchor",href:"#使用方法-3","aria-label":'Permalink to "使用方法"'},"​")],-1),l("p",null,"创建一个服务文件 /etc/systemd/system/myapp.service：",-1),l("p",null,"然后启动并设置开机自启：",-1),l("h3",{id:"利弊分析-3",tabindex:"-1"},[n("利弊分析 "),l("a",{class:"header-anchor",href:"#利弊分析-3","aria-label":'Permalink to "利弊分析"'},"​")],-1),l("ul",null,[l("li",null,[l("p",null,[n("​"),l("strong",null,"优点"),n("​：")]),l("ul",null,[l("li",null,[n("​"),l("strong",null,"自动重启"),n("​：程序崩了会自动拉起来（Restart=always）。")]),l("li",null,[n("​"),l("strong",null,"开机自启"),n("​：服务器重启后服务会自动运行。")]),l("li",null,[n("​"),l("strong",null,"日志管理"),n("​：通过 journalctl 统一管理日志。")]),l("li",null,[n("​"),l("strong",null,"标准化"),n("​：这是 Linux 运维的标准操作。")])])]),l("li",null,[l("p",null,[n("​"),l("strong",null,"缺点"),n("​：")]),l("ul",null,[l("li",null,"配置相对繁琐，不适合“跑一次就扔”的临时任务。"),l("li",null,"需要 Root 权限来配置服务。")])])],-1),l("hr",null,null,-1),l("h2",{id:"_5-补充-如何监控它们-top-htop",tabindex:"-1"},[n("5. 补充：如何监控它们？(Top/Htop) "),l("a",{class:"header-anchor",href:"#_5-补充-如何监控它们-top-htop","aria-label":'Permalink to "5. 补充：如何监控它们？(Top/Htop)"'},"​")],-1),l("p",null,[n("你在题目中提到了 top，其实 top 并不是用来“保持”进程运行的，而是用来"),l("strong",null,"监控"),n("正在运行的进程的。")],-1),l("p",null,"不管你用上面哪种方式（nohup, tmux, systemd）启动了后台进程，你都可以通过以下方式找到它们：",-1),l("ul",null,[l("li",null,[l("p",null,[n("​"),l("strong",null,"top / htop"),n("​： 实时查看 CPU 和 内存占用。如果你的后台任务很吃资源，一打开 top 就能在最上面看到它。")])]),l("li",null,[l("p",null,[n("​"),l("strong",null,"ps 命令"),n("​：")]),l("p",null,"精准查找特定的进程 PID。")])],-1),l("h2",{id:"总结",tabindex:"-1"},[n("总结 "),l("a",{class:"header-anchor",href:"#总结","aria-label":'Permalink to "总结"'},"​")],-1),l("ul",null,[l("li",null,[n("​"),l("strong",null,"临时跑个小脚本"),n("​：用 nohup command &，简单粗暴。")]),l("li",null,[n("​"),l("strong",null,"开发调试、耗时任务、需要看进度"),n("​：推荐 ​"),l("strong",null,"Tmux"),n("​。这是是真的很好用。")]),l("li",null,[n("​"),l("strong",null,"生产环境部署服务"),n("​：写 "),l("strong",null,"Systemd"),n(" 配置文件，保证服务的高可用。")])],-1)])]),"main-header":a(()=>[t(e.$slots,"main-header")]),"main-header-after":a(()=>[t(e.$slots,"main-header-after")]),"main-nav":a(()=>[t(e.$slots,"main-nav")]),"main-content-before":a(()=>[t(e.$slots,"main-content-before")]),"main-content":a(()=>[t(e.$slots,"main-content")]),"main-content-after":a(()=>[t(e.$slots,"main-content-after")]),"main-nav-before":a(()=>[t(e.$slots,"main-nav-before")]),"main-nav-after":a(()=>[t(e.$slots,"main-nav-after")]),comment:a(()=>[t(e.$slots,"comment")]),footer:a(()=>[t(e.$slots,"footer")]),aside:a(()=>[t(e.$slots,"aside")]),"aside-custom":a(()=>[t(e.$slots,"aside-custom")]),default:a(()=>[t(e.$slots,"default")]),_:3},8,["frontmatter"])}}};export{V as default,k as usePageData};
